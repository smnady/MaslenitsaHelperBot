# Масленичный Помощник

**Масленичный Помощник** — Telegram-бот, созданный для сопровождения празднования Масленицы. Бот предоставляет
пользователю рецепты блинов, поздравления, описание развлекательных игр и возможность оставить обратную связь.

Проект был разработан в рамках мероприятия в университете, однако функционал бота может быть использован для других
тематических праздников.

---

## Возможности

### Приветственное сообщение

После первого запуска бот отправляет приветственное сообщение с информацией о своих функциях. Это позволяет пользователю
сразу понять, как взаимодействовать с ботом.

<details>

<img src="https://github.com/user-attachments/assets/5a3292c8-d6d3-4f7e-9b94-b3c11f404fb5" alt="image" width="250"/>
    
</details>

---

### Основное меню

Бот предлагает 4 основных функции через кнопки меню:

1. **Поздравление** — праздничное сообщение на тему Масленицы.
2. **Рецепты блинов** — список рецептов блинов с ингредиентами и пошаговыми инструкциями.
3. **Станции** — описание игр и активностей, которые могут быть организованы в рамках празднования Масленицы.
4. **Обратная связь** — возможность оставить отзыв или оценку мероприятия.

---

### Рецепты блинов

Пользователь может получить пошаговые рецепты для приготовления блинов. Среди доступных рецептов:

- Классические блины.
- Блины на кефире.
- Гречневые блины.
- Овсяные блины.
- и др.

Каждый рецепт представлен в структурированной форме:

- Список ингредиентов.
- Процесс приготовления.

Пример запроса: `/recipes`.

<details>

<img src="https://github.com/user-attachments/assets/cd6bc1ca-71a5-46cd-8b62-567cb9510606" alt="image" width="250"/>
<img src="https://github.com/user-attachments/assets/08c1da9f-1db7-4a40-a600-fe759c0d8aa8" alt="image" width="250"/>

</details>

---

### Станции

В этом разделе бот описывает идеи для игр и активностей, которые могут быть полезны для организации праздника. Среди
них:

- Танцы с блинами (задание на координацию).
- Плетение лент (состязание на скорость).
- Угадывание начинки блинов.
- и др.

Игры можно адаптировать под разные мероприятия. Команда: `/stations`.

<details>
    
<img src="https://github.com/user-attachments/assets/e956d4d6-0f14-432d-955b-6b844ed98e22" alt="image" width="250"/>
<img src="https://github.com/user-attachments/assets/6e1c9735-40fe-482f-8d28-6d9fe8b63a32" alt="image" width="250"/>

</details>

---

### Обратная связь

Бот предоставляет возможность оставить отзыв, указать, что понравилось, и предложить доработки. Это может быть полезно,
если вы используете бота для организации мероприятий.

Кроме того, обратная связь реализована в виде сессии и должна быть завершена для продолжения пользования ботом. В
случае, когда сессия не завершается в течение нормированного времени, она прерывается автоматически и промежуточные
данные опроса не записываются в БД.

<details>

<img src="https://github.com/user-attachments/assets/e9b12095-505c-446d-8940-b27f1070eac4" alt="image" width="250"/>
<img src="https://github.com/user-attachments/assets/0c26f1fc-8c8a-49da-bb8f-b3765b4c449d" alt="image" width="250"/>
<img src="https://github.com/user-attachments/assets/6e258ad7-3aeb-4974-8da1-014013070b05" alt="image" width="250"/>

</details>

---

### Админ-панель

Для администраторов предоставляется защищённая панель управления, доступная через **/admin/dashboard**. Возможности
панели включают:

- Список пользователей:
    - Имя, Telegram-логин, дата первого использования.
- Анализ отзывов:
    - Средняя оценка мероприятий и блинов.
    - Комментарии участников.
- Просмотр статистики в удобной табличной форме.

#### Доступ:

- Авторизация: `/admin/login` — требует логина и пароля.
- Выход: `/admin/logout`.

<details>
    
<img src="https://github.com/user-attachments/assets/b5c65673-79cc-487c-ba7a-c802906d3b81" alt="image" width="250"/>
<img src="https://github.com/user-attachments/assets/53155573-3e4b-4807-95c9-8e93ecc25ba2" alt="image" width="250"/>

</details>

---

## Технические детали

### Основной стек технологий

- **Язык:** Java 21
- **Фреймворк:** Spring Boot
- **База данных:** PostgreSQL
- **Telegram Bot API:** [TelegramBots](https://github.com/rubenlagus/TelegramBots)
- **Контейнеризация:** Docker
- **Сборка:** Maven
- **Логирование:** SLF4J (или другая совместимая библиотека)
- **Обработка данных:** Spring Data JPA — для упрощения работы с базой данных через ORM.
- **Безопасность:** Spring Security

### Архитектура

Приложение разделено на несколько логических уровней, которые выполняют отдельные функции. Основные компоненты архитектуры:

1. **Слой обработки команд Telegram**:  
   Обрабатывает взаимодействие с пользователем через Telegram Bot API. Принимает сообщения, вызывает соответствующие команды, такие как `/recipes`, `/stations`, и передаёт ответы пользователю.

2. **Бизнес-логика**:  
   Реализована в виде:
    - Классов-команд для обработки пользовательских запросов.
    - Административного функционала для управления пользователями и сбора статистики.

3. **Слой данных**:  
   Работает через **Spring Data JPA** с базой данных **PostgreSQL**. База данных хранит:
    - Пользователей бота.
    - Оценки и обратную связь.
    - Настройки и другие данные.

4. **Админ-панель**:  
   Веб-интерфейс, основанный на Spring MVC и шаблонизаторе Thymeleaf. Предоставляет:
    - Просмотр пользователей, отзывов и статистики.
    - Аутентификацию и авторизацию через **Spring Security**.

---

## Установка

### Запуск через Docker

1. **Склонируйте репозиторий:**
    ```bash
    git clone https://github.com/smnady/MaslenitsaHelperBot.git
    cd MaslenitsaHelperBot
    ```
2. **Создайте бота в @BotFather в telegram** и скопируйте полученный токен доступа к нему.

3. **Настройте переменные окружения:**
   Откройте файл `docker-compose.yml` и укажите значения для следующих переменных окружения:
    ```yaml
    MASLENITSA_BOT_CONFIG_TOKEN: <ваш_токен_бота_из_@BotFather>
    MASLENITSA_BOT_WEBHOOK_URL: <вебхук_урл_бота>
    MASLENITSA_BOT_ADMIN_USERNAME: <логин_администратора_для_входа_в_админку>
    MASLENITSA_BOT_ADMIN_PASSWORD: <пароль_администратора_для_входа_в_админку>
    ```

   Пример:
    ```yaml
    environment:
      MASLENITSA_BOT_CONFIG_NAME: Maslenitsa Helper
      MASLENITSA_BOT_CONFIG_TOKEN: abc123TOKEN
      MASLENITSA_BOT_WEBHOOK_URL: https://example.com/
      MASLENITSA_BOT_ADMIN_USERNAME: admin
      MASLENITSA_BOT_ADMIN_PASSWORD: topsecret
    ```

4. **Соберите и запустите контейнеры:**
   Выполните следующую команду:
    ```bash
    docker-compose up --build
    ```

5. **Проверка работы:**
   После успешного запуска созданный в @BotFather бот будет предоставлять интерфейс для взаимодействия с сервером.
   Также можно проверить работу админки по адресу заданного вебхука.

7. **Остановка контейнеров:**
   Чтобы отключить все контейнеры, выполните:
    ```bash
    docker-compose down
    ```

---

### Примечания

- Контейнеры автоматически перезапускаются при сбоях благодаря свойству `restart: always`.
- Данные Postgres сохраняются внутри тома `pg_data`, что гарантирует их сохранность при перезапуске контейнеров.
- Убедитесь, что переменные окружения корректно заполнены перед запуском.

---

## Примеры использования

- `/start` — отправляет приветственное сообщение.
- `/recipes` — выводит список рецептов блинов.
- `/stations` — описывает игры и активности.
- `/feedback` — возможность отправить отзыв.

---

## Контекст

Проект был разработан для сопровождения мероприятия в университете, посвященного празднованию Масленицы. Тем не менее,
благодаря гибкости реализации бот может быть адаптирован для других тематических событий.
